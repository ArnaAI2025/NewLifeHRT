<div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4" (click)="onCancel()">
  <div class="bg-white rounded-lg shadow-xl max-w-3xl w-full relative overflow-y-auto" (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="flex items-center justify-between p-6 pt-4 pb-4 border-b border-gray-200">
      <h2 class="text-xl font-semibold text-gray-800 flex items-center proposal-modal-heading">
        {{ popupTitle }}
      </h2>
      <button type="button" mat-icon-button (click)="onCancel()" class="text-gray-500 hover:text-gray-700">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <!-- Body -->
    <div class="p-6">
      <form [formGroup]="settleUpForm" class="space-y-6 relative">
        <div class="bg-blue-50 p-4 rounded-md mb-4">
          <p class="text-sm text-blue-800">
            {{ balanceLabel }} <strong>${{ getAbsoluteOutstandingBalance() | number:'1.2-2' }}</strong>
          </p>
          <p class="text-xs text-blue-600 mt-1">
            {{ instructionText }}
          </p>
        </div>

        <div class="space-y-2 custom-text-box">
          <label class="block text-sm font-medium text-gray-700">
            {{ fieldLabel }}
          </label>
          <mat-form-field appearance="outline" class="w-full form-input form-input-text">
            <input
              matInput
              formControlName="settleAmount"
              type="number"
              placeholder="Enter {{ fieldLabel | lowercase }}"
              [min]="0.01"
              [max]="getMaxSettleAmount()"
              step="0.01"
              class="text-sm"
            />
            <mat-error *ngIf="settleAmountControl?.hasError('required')">
              {{ fieldLabel }} is required
            </mat-error>
            <mat-error *ngIf="settleAmountControl?.hasError('min')">
              {{ fieldLabel }} must be greater than 0
            </mat-error>
            <mat-error *ngIf="settleAmountControl?.hasError('max')">
              {{ fieldLabel }} cannot exceed ${{ getMaxSettleAmount() | number:'1.2-2' }}
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Footer Buttons -->
        <div class="flex justify-end space-x-4 pt-4 border-t border-gray-200">
          <button mat-stroked-button type="button" (click)="onCancel()" class="secondry-button-add">
            Cancel
          </button>
          <button
            mat-flat-button
            color="primary"
            (click)="onSave()"
            [disabled]="!settleUpForm.valid || isSubmitting"
            class="primary-btn-add"
          >
            {{ isSubmitting ? 'Processing...' : 'Save' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
