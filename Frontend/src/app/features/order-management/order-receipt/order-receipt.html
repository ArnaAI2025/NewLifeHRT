<!-- Loading Indicator -->
<div *ngIf="isLoading(); else receiptTemplate" class="flex justify-center items-center py-12">
    <span class="text-gray-600 text-sm">Loading ...</span>
</div>

<!-- Receipt Content -->
<ng-template #receiptTemplate>
    <div class="max-w-3xl mx-auto bg-white shadow-lg border rounded p-6 relative">

        <!-- Header Row with Title + Close Button -->
        <div class="flex items-center justify-between border-b border-gray-300 pb-3 mb-4">
            <h2 class="text-xl font-bold text-gray-800">Receipt</h2>
            <button mat-icon-button (click)="onClose()">
                <mat-icon>close</mat-icon>
            </button>
        </div>


        <!-- Actual Receipt Body -->
        <div *ngIf="order() as order">

            <!-- Top Branding -->
            <div class="flex items-start justify-between">
                <div class="flex flex-col items-start">
                    <img src="assets/images/logo.png" alt="NEWLIFE Logo" class="h-12 mb-1" />
                    <div class="text-xs tracking-wide text-gray-700 font-semibold">
                        HORMONE REPLACEMENT THERAPY
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-xl font-extrabold text-gray-700 tracking-wider mb-1">
                        NEWLIFE<br />RECEIPT
                    </div>
                    <div class="text-sm mt-3 space-y-1">
                        <div>ORDER ID: <span class="font-bold">{{ order.id }}</span></div>
                        <div>TOTAL AMOUNT:
                            <span class="font-bold">${{ order.totalAmount | number: '1.2-2' }}</span>
                        </div>
                        <div>CREATE DATE:
                            <span class="font-bold">{{ order.createdAt | date: 'short' }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Patient & Description -->
            <div class="flex justify-between items-center mt-6">
                <div>
                    <div class="font-semibold text-black text-sm">PATIENT:</div>
                    <div class="text-black text-sm">{{ order.patientName }}</div>
                </div>
                <div>
                    <div class="font-semibold text-black text-sm">DESCRIPTION:</div>
                    <div class="text-black text-sm">{{ order.description || '-' }}</div>
                </div>
            </div>

            <!-- Medications Table -->
            <div class="mt-8 mb-2 text-black font-bold">MEDICATIONS</div>
            <div class="overflow-x-auto">
                <table class="min-w-full border border-black text-sm">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="border border-black py-2 px-3 text-left font-semibold text-xs">DESCRIPTION</th>
                            <th class="border border-black py-2 px-3 text-center font-semibold text-xs">QUANTITY</th>
                            <th class="border border-black py-2 px-3 text-right font-semibold text-xs">UNIT PRICE</th>
                            <th class="border border-black py-2 px-3 text-right font-semibold text-xs">TOTAL</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let detail of order.orderDetails">
                            <td class="border border-black px-3 py-2 align-top">
                                {{ detail.productName }}
                                <ng-container *ngIf="detail.isColdStorageProduct">
                                    <br />
                                    <span class="text-red-600 font-medium text-xs">*SHIPS COLD*</span>
                                </ng-container>
                            </td>
                            <td class="border border-black text-center px-3 py-2 align-top">{{ detail.quantity }}</td>
                            <td class="border border-black text-right px-3 py-2 align-top">${{ detail.perUnitAmount |
                                number: '1.2-2' }}</td>
                            <td class="border border-black text-right px-3 py-2 align-top">${{ detail.amount | number:
                                '1.2-2' }}</td>
                        </tr>

                        <tr *ngIf="order.shippingMethodAmount">
                            <td class="border border-black px-3 py-2 align-top">
                                {{ order.shippingMethodName || 'Shipping' }}
                            </td>
                            <td class="border border-black text-center px-3 py-2 align-top">1</td>
                            <td class="border border-black text-right px-3 py-2 align-top">${{
                                order.shippingMethodAmount | number: '1.2-2' }}</td>
                            <td class="border border-black text-right px-3 py-2 align-top">${{
                                order.shippingMethodAmount | number: '1.2-2' }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Totals & Paid Stamp -->
            <div class="flex items-start mt-4">
                <div class="mt-8 ml-2" *ngIf="data.isPaidLogo">
                    <div class="relative w-32 h-32 flex items-center justify-center">
                        <img src="assets/images/paid-stamp.png" alt="PAID" class="absolute w-28 h-28 opacity-95" />
                    </div>
                </div>
                <div class="ml-auto w-60">
                    <table class="w-full text-sm">
                        <tr>
                            <td class="font-semibold text-black border-t border-x border-black py-2 px-3">SUBTOTAL</td>
                            <td class="border-t border-x border-black text-right py-2 px-3">${{ order.subtotal |
                                number:'1.2-2' }}</td>
                        </tr>
                        <tr>
                            <td class="font-semibold text-black border-x border-black py-2 px-3">SURCHARGE</td>
                            <td class="border-x border-black text-right py-2 px-3">${{ order.surcharge || 0 |
                                number:'1.2-2' }}</td>
                        </tr>
                        <tr *ngIf="order.shippingMethodAmount">
                            <td class="font-semibold text-black border-x border-black py-2 px-3">{{ order.shippingMethodName || 'Shipping'}}</td>
                            <td class="border-x border-black text-right py-2 px-3">${{
                            order.shippingMethodAmount | number: '1.2-2' }}</td>
                        </tr>
                        <tr>
                            <td colspan="2" class="p-0 m-0">
                                <hr class="border-black my-1" />
                            </td>
                        </tr>
                        <tr>
                            <td class="font-bold text-black border border-black text-base py-2 px-3">TOTAL DUE</td>
                            <td class="font-bold text-black border border-black text-right text-base py-2 px-3">${{
                                order.totalAmount | number:'1.2-2' }}</td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- Footer -->
            <div class="mt-8 pt-4 border-t border-gray-800 text-center">
                <p class="text-xs text-gray-700 leading-relaxed">
                    We impose a surcharge of 3.99% on the transaction amount on all credit cards,
                    which is not greater than our cost of acceptance.
                </p>
            </div>
        </div>
    </div>
</ng-template>