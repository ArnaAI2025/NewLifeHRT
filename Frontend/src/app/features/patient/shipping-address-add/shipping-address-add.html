<!-- Modal wrapper - only show when isVisible is true -->
<div *ngIf="isVisible" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
  (click)="onClose()">

  <!-- Modal Content -->
  <div class="bg-white rounded-lg shadow-xl max-w-3xl w-full relative overflow-y-auto"
    (click)="$event.stopPropagation()">

    <!-- Header -->
    <div class="flex items-center justify-between p-6 pt-4 pb-4 border-b border-gray-200">
      <h2 class="text-xl font-semibold text-gray-800 flex items-center proposal-modal-heading">
        <mat-icon class="mr-2 text-blue-600">home</mat-icon>
        {{ getModalTitle() }}
      </h2>
      <button type="button" mat-icon-button (click)="onClose()" class="text-gray-500 hover:text-gray-700">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <!-- Loading / Submitting Overlay -->
    <div *ngIf="isLoading() || isSubmitting()"
      class="absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center z-10 rounded-lg">
      <mat-spinner diameter="40"></mat-spinner>
    </div>

    <!-- Body -->
    <div class="p-6">
      <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-6 relative">

        <!-- Address Fields -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <!-- Address Type -->
          <div class="space-y-2 custom-text-box">
            <label class="block text-sm font-medium text-gray-700">
              Address Type <span class="text-red-500">*</span>
            </label>
            <mat-form-field appearance="outline" class="w-full form-input form-input-text">
              <input matInput formControlName="addressType" placeholder="Home, Work, etc." />
              <mat-error *ngIf="isFieldInvalid('addressType')">
                {{ getFieldError('addressType') }}
              </mat-error>
            </mat-form-field>
          </div>

          <!-- Street -->
          <div class="space-y-2 custom-text-box">
            <label class="block text-sm font-medium text-gray-700">
              Street <span class="text-red-500">*</span>
            </label>
            <mat-form-field appearance="outline" class="w-full form-input form-input-text">
              <input matInput formControlName="addressLine1" placeholder="123 Main St" />
              <mat-error *ngIf="isFieldInvalid('addressLine1')">
                {{ getFieldError('addressLine1') }}
              </mat-error>
            </mat-form-field>
          </div>

          <!-- City -->
          <div class="space-y-2 custom-text-box">
            <label class="block text-sm font-medium text-gray-700">
              City <span class="text-red-500">*</span>
            </label>
            <mat-form-field appearance="outline" class="w-full form-input form-input-text">
              <input matInput formControlName="city" placeholder="City" />
              <mat-error *ngIf="isFieldInvalid('city')">
                {{ getFieldError('city') }}
              </mat-error>
            </mat-form-field>
          </div>
          <!-- Country -->
          <div class="space-y-2 custom-text-box">
            <label class="block text-sm font-medium text-gray-700">
              Country <span class="text-red-500">*</span>
            </label>
            <mat-form-field appearance="outline" class="w-full form-input form-input-text">
              <input type="text" matInput placeholder="Country" [formControl]="countryControl" [matAutocomplete]="auto"
                autocomplete="off" (input)="onCountryInput($any($event.target).value)" />
          
          
              <mat-autocomplete #auto="matAutocomplete" (optionSelected)="onCountrySelected($event.option.value)"
                [displayWith]="displayCountryName">
                <mat-option *ngFor="let country of filteredcountriesList" [value]="country.id">
                  {{ country.value }}
                </mat-option>
              </mat-autocomplete>
          
              <mat-error *ngIf="isFieldInvalid('countryId')">
                {{ getFieldError('countryId') }}
              </mat-error>
            </mat-form-field>
          
          </div>
          <!-- State -->
<div class="space-y-2 custom-text-box">
  <label class="block text-sm font-medium text-gray-700">
    State<span class="text-red-500">*</span>
  </label>
  <mat-form-field appearance="outline" class="w-full form-input form-input-text">
    <mat-select formControlName="stateId" placeholder="Select State" [disabled]="allStates.length === 0">
      <mat-option *ngFor="let state of allStates" [value]="state.id">
        {{ state.value }}
      </mat-option>
    </mat-select>
    <mat-error *ngIf="isFieldInvalid('stateId')">
      {{ getFieldError('stateId') }}
    </mat-error>
  </mat-form-field>
</div>


          <!-- Postal Code -->
          <div class="space-y-2 custom-text-box">
            <label class="block text-sm font-medium text-gray-700">
              Postal Code <span class="text-red-500">*</span>
            </label>
            <mat-form-field appearance="outline" class="w-full form-input form-input-text">
              <input matInput formControlName="postalCode" maxlength="6" placeholder="123456"
                (keypress)="allowOnlyNumbers($event)" />
              <mat-error *ngIf="isFieldInvalid('postalCode')">
                {{ getFieldError('postalCode') }}
              </mat-error>
            </mat-form-field>
          </div>

          
        </div>

        <!-- Footer Buttons -->
        <div class="flex justify-end space-x-4 pt-4 border-t border-gray-200">
          <button mat-stroked-button type="button" (click)="onClose()" [disabled]="isSubmitting()" class="secondry-button-add">
            Cancel
          </button>
          <button mat-flat-button color="primary" type="submit" [disabled]="isSubmitting()" class="primary-btn-add">
            <mat-spinner *ngIf="isSubmitting()" diameter="20" class="mr-2"></mat-spinner>
            {{ isSubmitting() ? 'Saving...' : 'Save' }}
          </button>
        </div>

      </form>
    </div>
  </div>
</div>
