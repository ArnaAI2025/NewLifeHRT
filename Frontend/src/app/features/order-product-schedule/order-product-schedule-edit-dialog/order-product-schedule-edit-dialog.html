<div class="bg-white rounded-lg shadow-xl w-full sm:max-w-2xl max-h-[90vh] overflow-y-auto">
  <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"
    (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="flex items-center justify-between p-6 border-b border-gray-200 sticky top-0 bg-white z-10">
      <div>
        <h2 class="text-xl font-semibold text-gray-800">Edit Schedule</h2>
        <div class="mt-2 text-sm text-gray-600">
          <p><strong>Product:</strong> {{data.scheduleSummary.productName}}</p>
          <p><strong>Protocol:</strong> {{data.scheduleSummary.protocol}}</p>
          <p><strong>Frequency:</strong> {{data.scheduleSummary.frequencyType}}</p>
        </div>
        <div *ngIf="noteMessage" class="text-yellow-600 text-sm mt-2">
          {{ noteMessage }}
        </div>
      </div>
      <button type="button" mat-icon-button (click)="onClose()" class="text-gray-500 hover:text-gray-700">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <div class="p-6">
      <form [formGroup]="editScheduleForm" class="space-y-6">
        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700">Start Date</label>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput [matDatepicker]="picker" [matDatepickerFilter]="disablePastDates" formControlName="startDate">
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
            <mat-error *ngIf="editScheduleForm.get('startDate')?.hasError('required')">
              Start date is required
            </mat-error>
          </mat-form-field>
        </div>

        <div class="space-y-3">
          <div class="flex items-center justify-between">
            <label class="block text-sm font-medium text-gray-700">Days</label>
          </div>
          <div formArrayName="days" class="grid grid-cols-2 md:grid-cols-4 gap-2">
            <div *ngFor="let day of daysOfWeek; let i = index" class="flex items-center">
              <mat-checkbox [formControlName]="i" class="mr-2 custom-mat-checkbox">
                {{day.label}}
              </mat-checkbox>
            </div>
          </div>
          <mat-error *ngIf="editScheduleForm.get('days')?.hasError('daysCount')" class="text-red-500 text-xs">
            {{editScheduleForm.get('days')?.errors?.['daysCount']}}
          </mat-error>
        </div>

        <div class="space-y-4">
          <div class="flex items-center justify-between">
            <label class="block text-sm font-medium text-gray-700">Medicine Times</label>
          </div>

          <div formArrayName="times" class="space-y-3">
            <div *ngFor="let timeGroup of timesArray.controls; let i = index" [formGroupName]="i"
              class="flex items-end space-x-3 p-3 border border-gray-200 rounded-lg">

              <div class="flex-1">
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  Dose {{ i + 1 }}
                </label>
                <input type="time"
                  class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:outline-none"
                  formControlName="time" required />
                <div *ngIf="timeGroup.get('time')?.hasError('required')" class="text-red-500 text-xs mt-1">
                  Time is required
                </div>
              </div>
            </div>
          </div>

          <mat-error *ngIf="editScheduleForm.get('times')?.hasError('noTimes')" class="text-red-500 text-xs">
            At least one time slot is required
          </mat-error>
          <mat-error *ngIf="editScheduleForm.get('times')?.hasError('duplicateTimes')" class="text-red-500 text-xs">
            Duplicate times are not allowed
          </mat-error>
        </div>

        <div class="flex justify-end space-x-4 pt-4 border-t border-gray-200">
          <button mat-stroked-button type="button" (click)="onClose()" class="secondry-button-add">
            Cancel
          </button>
          <button mat-flat-button color="primary" (click)="onSave()" [disabled]="!editScheduleForm.valid"
            class="primary-btn-add">
            Save
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
