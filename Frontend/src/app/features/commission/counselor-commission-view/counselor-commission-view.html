<div class="card-color rounded-lg shadow-sm flex-wrap gap-4 mb-6 table-view-header border border-gray-200 p-6">
    <div class="flex items-center flex-wrap gap-4 justify-between mb-6 table-view-header">
        <div class="flex items-center flex-wrap w-full">
            <button mat-icon-button (click)="back()" class="header-back-button">
                <mat-icon>chevron_left</mat-icon>
            </button>
            <h2 class="list-page-heading">Counselor Commissions</h2>

            <div class="flex items-center space-x-3 filter-input search-box search-box-dsk ml-6">
                <div class="relative">
                    <mat-icon class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">search</mat-icon>
                    <input matInput type="text" placeholder="Filter by patient, pharmacy, type, amount"
                        [(ngModel)]="filterKeyword" (input)="applyFilter()" [disabled]="isLoading()"
                        class="pl-10 pr-4 py-2 border border-gray-300 rounded-md w-64" />
                </div>
            </div>
        </div>
    </div>

    <div *ngIf="isLoading()"
        class="absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center z-10 rounded-lg">
        <mat-spinner diameter="40"></mat-spinner>
    </div>

    <div class="overflow-x-auto custom-table-view" [class.opacity-50]="isLoading()">
        <table mat-table [dataSource]="dataSource" matSort class="w-full custom-table">
            <ng-container matColumnDef="patientName">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Patient</th>
                <td mat-cell *matCellDef="let el">{{ el.patientName }}</td>
            </ng-container>

            <ng-container matColumnDef="pharmacyName">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Pharmacy</th>
                <!-- <td mat-cell *matCellDef="let el">{{ el.pharmacyName }}</td> -->
                                <td mat-cell *matCellDef="let el" (click)="onEdit(el)">
                                    <span class="primary-text-color hover:underline cursor-pointer">
                                        {{ el.pharmacyName }}
                                    </span>
                                </td>
            </ng-container>

            <ng-container matColumnDef="totalSales">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Total Sales</th>
                <td mat-cell *matCellDef="let el">{{ el.totalSales | number : '1.2-2' }}</td>
            </ng-container>

            <ng-container matColumnDef="commissionsPayableAmount">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Commission</th>
                <td mat-cell *matCellDef="let el">{{ el.commissionsPayableAmount | number : '1.2-2' }}</td>
            </ng-container>

            <ng-container matColumnDef="entryType">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Type</th>
                <td mat-cell *matCellDef="let el">{{ el.entryType || 'N/A' }}</td>
            </ng-container>

            <ng-container matColumnDef="isActive">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let el">
                    <span class="px-2 py-1 rounded-full text-sm font-semibold"
                        [ngClass]="el.isActive ? 'bg-green-100 text-green-800 border border-green-300' : 'bg-gray-100 text-gray-800 border border-gray-300'">{{
                        el.isActive ? 'Active' : 'Inactive' }}</span>
                </td>
            </ng-container>
            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Actions</th>
                <td mat-cell *matCellDef="let element">
                    <button mat-icon-button [matMenuTriggerFor]="actionMenu" (click)="$event.stopPropagation()"
                        aria-label="More actions">
                        <mat-icon>more_vert</mat-icon>
                    </button>
            
                    <mat-menu #actionMenu="matMenu">
                        <button mat-menu-item (click)="onEdit(element)">
                            <span>Edit</span>
                        </button>
                    </mat-menu>
                </td>
            </ng-container>


            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
    </div>

    <div *ngIf="!isLoading() && dataSource.filteredData.length === 0" class="text-center py-12">
        <div class="flex flex-col items-center">
            <mat-icon class="text-gray-400 text-6xl mb-2">description</mat-icon>
            <h3 class="text-lg font-semibold">No commissions found</h3>
        </div>
    </div>

    <div class="main-paginator">
        <div class="paginator-section p-0">
            <mat-paginator #paginator [pageSizeOptions]="[5, 10, 20, 30]" [pageSize]="pageSize"
                [showFirstLastButtons]="true" [length]="dataSource.filteredData.length || 0" [disabled]="isLoading()"
                class="mat-mdc-paginator-container disabled:opacity-50">
            </mat-paginator>
        </div>
    </div>
</div>