<div class="bg-white rounded-[16px] shadow-sm border border-gray-200 p-6 bg-card-color">
  <!-- Header + Filters -->
  <div class="flex items-center justify-between flex-wrap gap-4 mb-4 table-view-header">
    <!-- Title + Search -->
    <div class="flex items-center flex-wrap gap-4">
      <h1 class="list-page-heading">Pool Details</h1>

      <!-- Search Bar -->
      <div class="relative">
        <mat-icon class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">search</mat-icon>
        <input
          matInput
          type="text"
          [(ngModel)]="searchKeyword"
          (input)="applyFilter()"
          placeholder="Filter by counselor, week or date"
          [disabled]="isLoading()"
          class="pl-10 pr-4 py-2 border border-gray-300 rounded-md w-64 disabled:bg-gray-100 h-12"
        />
      </div>
    </div>

    <!-- Quick Filters -->
    <div class="flex flex-wrap items-center gap-3">
      <!-- Previous Week -->
      <button
        mat-flat-button
        class="secondry-button-add h-12 px-4 rounded-md flex items-center gap-1"
        (click)="onPreviousWeek()"
        [disabled]="isLoading()"
      >
        Previous Week (Friâ€“Thu)
      </button>

      <!-- Previous Month -->
      <button
        mat-stroked-button
        class="secondry-button-add h-12 px-4 rounded-md flex items-center gap-1"
        (click)="onPreviousMonth()"
        [disabled]="isLoading()"
      >
        Previous Month
      </button>

      <!-- Date Range -->
      <div class="flex items-center gap-1">
        <!-- From Date -->
                    <div class="space-y-2 custom-text-box w-40">
          <mat-form-field
            appearance="outline"
            class="w-full form-input form-input-text"
          >
            <input
              matInput
              [matDatepicker]="fromPicker"
              [(ngModel)]="customFromDate"
              placeholder="From Date"
              readonly
              (click)="fromPicker.open()"
              [disabled]="isLoading()"
            />
            <mat-datepicker-toggle
              matSuffix
              [for]="fromPicker"
            ></mat-datepicker-toggle>
            <mat-datepicker #fromPicker></mat-datepicker>
          </mat-form-field>
        </div>
      </div>
    <div class="flex items-center gap-2">
        <div class="space-y-2 custom-text-box w-40">
          <mat-form-field
            appearance="outline"
            class="w-full form-input form-input-text"
          >
            <input
              matInput
              [matDatepicker]="toPicker"
              [(ngModel)]="customToDate"
              placeholder="To Date"
              readonly
              (click)="toPicker.open()"
              [disabled]="isLoading()"
            />
            <mat-datepicker-toggle
              matSuffix
              [for]="toPicker"
            ></mat-datepicker-toggle>
            <mat-datepicker #toPicker></mat-datepicker>
          </mat-form-field>
        </div>
    </div>
        <div class="flex items-center gap-2">

        <!-- Apply Button -->
        <button
          mat-flat-button
          class="primary-btn h-12 px-4 rounded-md flex items-center gap-1"
          (click)="onApplyCustomDates()"
          [disabled]="isLoading()"
        >
          Apply
        </button>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div
    *ngIf="isLoading()"
    class="absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center z-10 rounded-lg"
  >
    <mat-spinner diameter="40"></mat-spinner>
  </div>

  <!-- Table -->
  <div class="overflow-x-auto custom-table-view" [class.opacity-50]="isLoading()">
    <table mat-table [dataSource]="dataSource" matSort class="custom-table">
      <!-- Counselor -->
      <ng-container matColumnDef="counselorName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Counselor</th>
        <td mat-cell *matCellDef="let element" (click)="onEdit(element)">
          <span class="primary-text-color hover:underline cursor-pointer">
            {{ element.counselorName }}
          </span>
        </td>
      </ng-container>

      <!-- Week -->
      <ng-container matColumnDef="week">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Week</th>
        <td mat-cell *matCellDef="let element">{{ element.week }}</td>
      </ng-container>

      <!-- From Date -->
      <ng-container matColumnDef="fromDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>From Date</th>
        <td mat-cell *matCellDef="let element">
          {{ element.fromDate | mmddyyyyDate }}
        </td>
      </ng-container>

      <!-- To Date -->
      <ng-container matColumnDef="toDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>To Date</th>
        <td mat-cell *matCellDef="let element">
          {{ element.toDate | mmddyyyyDate }}
        </td>
      </ng-container>

      <!-- Actions -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let element">
          <button
            mat-icon-button
            [matMenuTriggerFor]="actionMenu"
            (click)="$event.stopPropagation()"
            aria-label="More actions"
          >
            <mat-icon>more_vert</mat-icon>
          </button>

          <mat-menu #actionMenu="matMenu">
            <button mat-menu-item (click)="onEdit(element)">
              <span>Edit</span>
            </button>
          </mat-menu>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <!-- No Data -->
    <div class="text-center py-8" *ngIf="!dataSource.filteredData.length && !isLoading()">
      <p class="text-gray-500">No Pool Detail records available.</p>
    </div>
  </div>

  <!-- Paginator -->
  <div class="main-paginator">
    <div class="paginator-section p-0">
      <mat-paginator
        #paginator
        [pageSizeOptions]="[50, 100, 250, 500]" [pageSize]="100" 
        [showFirstLastButtons]="true"
        [length]="dataSource.filteredData.length || 0"
        [disabled]="isLoading()"
        class="mat-mdc-paginator-container disabled:opacity-50"
      >
      </mat-paginator>
    </div>
  </div>
</div>
