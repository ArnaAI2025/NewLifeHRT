<!-- Sticky, SOLID header (no transparency) -->
<header class="sticky top-0 z-30 bg-white border-b shadow-sm">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between py-3">
      <div class="flex items-center gap-2">
        <button mat-icon-button (click)="back()" class="rounded-full hover:bg-gray-100">
          <mat-icon>chevron_left</mat-icon>
        </button>
        <h1 class="text-lg sm:text-xl font-semibold tracking-tight">Counselor Commission</h1>
      </div>

      <!-- Right-side status chip -->
      <div *ngIf="detail as d">
        <span
          class="inline-flex items-center rounded-full px-3 py-1 text-xs font-medium border"
          [ngClass]="d.commissionPayStatus
            ? 'bg-green-50 text-green-700 border-green-200'
            : 'bg-yellow-50 text-yellow-700 border-yellow-200'">
          <span class="w-2 h-2 mr-2 rounded-full"
                [ngClass]="d.commissionPayStatus ? 'bg-green-500' : 'bg-yellow-500'"></span>
          {{ fmtBool(d.commissionPayStatus) }}
        </span>
      </div>
    </div>
  </div>
</header>

<main class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6">

  <!-- KPI TILES -->
  <section class="mb-4" *ngIf="detail as d">
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
      <!-- Net Sales -->
      <div class="kpi-tile">
        <div class="kpi-h">
          <div class="kpi-label">Net Sales</div>
          <mat-icon class="kpi-icon">trending_up</mat-icon>
        </div>
        <div class="kpi-val">{{ fmtMoney(d.subTotalAmount) }}</div>
      </div>

      <!-- Total Amount -->
      <div class="kpi-tile">
        <div class="kpi-h">
          <div class="kpi-label">Total Amount</div>
          <mat-icon class="kpi-icon">paid</mat-icon>
        </div>
        <div class="kpi-val">{{ fmtMoney(d.totalAmount) }}</div>
      </div>

      <!-- Commission Payable -->
      <div class="kpi-tile">
        <div class="kpi-h">
          <div class="kpi-label">Commission Payable</div>
          <mat-icon class="kpi-icon">calculate</mat-icon>
        </div>
        <div class="kpi-val">{{ fmtMoney(d.commissionPayable) }}</div>
      </div>

      <!-- Profit / Loss -->
      <div class="kpi-tile">
        <div class="kpi-h">
          <div class="kpi-label">Profit / Loss</div>
          <mat-icon class="kpi-icon">insights</mat-icon>
        </div>
        <div class="kpi-val" [ngClass]="profitOrLossAmount?.startsWith('-') ? 'text-rose-600' : 'text-emerald-600'">
          {{ profitOrLossAmount }}
        </div>
      </div>
    </div>
  </section>

  <!-- MAIN CARD -->
  <div class="relative rounded-2xl border border-gray-200 bg-white shadow-sm">

    <!-- Inline loader -->
    <div *ngIf="isLoading" class="absolute inset-0 z-10 flex items-center justify-center rounded-2xl bg-white bg-opacity-70">
      <mat-spinner diameter="40"></mat-spinner>
    </div>

    <form *ngIf="detail as d" class="p-4 sm:p-6 lg:p-8">

      <!-- Counselor & Order Info -->
      <div class="section-header">
        <span class="section-accent"></span>
        <h3 class="section-title">Counselor &amp; Order Info</h3>
        <div class="section-rule"></div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <div>
          <label class="field-label">Sales Person</label>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput class="text-sm"
                   [value]="d.counselorName || '-'" [readonly]="readOnlyMode" [disabled]="readOnlyMode" />
          </mat-form-field>
        </div>

        <div>
          <label class="field-label">Commission Pay Status</label>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput class="text-sm"
                   [value]="fmtBool(d.commissionPayStatus)" [readonly]="readOnlyMode" [disabled]="readOnlyMode" />
          </mat-form-field>
        </div>

        <div>
          <label class="field-label">Related To Order</label>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput class="text-sm"
                   [value]="d.ordersName || '-'" [readonly]="readOnlyMode" [disabled]="readOnlyMode" />
          </mat-form-field>
        </div>

        <div>
          <label class="field-label">Week Summary</label>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput class="text-sm"
                   [value]="d.weekSummary || '-'" [readonly]="readOnlyMode" [disabled]="readOnlyMode" />
          </mat-form-field>
        </div>

        <div>
          <label class="field-label">Patient Name</label>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput class="text-sm"
                   [value]="d.patientName || '-'" [readonly]="readOnlyMode" [disabled]="readOnlyMode" />
          </mat-form-field>
        </div>

        <div>
          <label class="field-label">Pharmacy Name</label>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput class="text-sm"
                   [value]="d.pharmacyName || '-'" [readonly]="readOnlyMode" [disabled]="readOnlyMode" />
          </mat-form-field>
        </div>
      </div>

      <!-- Financials -->
      <div class="section-header mt-8">
        <span class="section-accent"></span>
        <h3 class="section-title">Financials</h3>
        <div class="section-rule"></div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <div>
          <label class="field-label">Syringe</label>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput class="text-sm"
                   [value]="fmtMoney(d.syringe)" [readonly]="readOnlyMode" [disabled]="readOnlyMode" />
          </mat-form-field>
        </div>

        <div>
          <label class="field-label">Net Sales</label>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput class="text-sm"
                   [value]="fmtMoney(d.subTotalAmount)" [readonly]="readOnlyMode" [disabled]="readOnlyMode" />
          </mat-form-field>
        </div>

        <div>
          <label class="field-label">Shipping</label>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput class="text-sm"
                   [value]="fmtMoney(d.shipping)" [readonly]="readOnlyMode" [disabled]="readOnlyMode" />
          </mat-form-field>
        </div>

        <div>
          <label class="field-label">Surcharge</label>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput class="text-sm"
                   [value]="fmtMoney(d.surcharge)" [readonly]="readOnlyMode" [disabled]="readOnlyMode" />
          </mat-form-field>
        </div>

        <div>
          <label class="field-label">Discount</label>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput class="text-sm"
                   [value]="fmtMoney(d.discount)" [readonly]="readOnlyMode" [disabled]="readOnlyMode" />
          </mat-form-field>
        </div>

        <div>
          <label class="field-label">Total Amount</label>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput class="text-sm"
                   [value]="fmtMoney(d.totalAmount)" [readonly]="readOnlyMode" [disabled]="readOnlyMode" />
          </mat-form-field>
        </div>
      </div>

      <!-- Commission -->
      <div class="section-header mt-8">
        <span class="section-accent"></span>
        <h3 class="section-title">Commission Calculations</h3>
        <div class="section-rule"></div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <div>
          <label class="field-label">Commission Applied Total</label>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput class="text-sm"
                   [value]="fmtMoney(d.commissionAppliedTotal)" [readonly]="readOnlyMode" [disabled]="readOnlyMode" />
          </mat-form-field>
        </div>

        <div>
          <label class="field-label">Commission Payable</label>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput class="text-sm"
                   [value]="fmtMoney(d.commissionPayable)" [readonly]="readOnlyMode" [disabled]="readOnlyMode" />
          </mat-form-field>
        </div>
      </div>

      <div class="mt-2">
        <label class="field-label">Commission Calculations</label>
        <mat-form-field appearance="outline" class="w-full">
          <textarea matInput rows="8" class="text-sm leading-relaxed"
                    [readonly]="readOnlyMode" [disabled]="readOnlyMode">{{ d.commissionCalculationDetails || '-' }}</textarea>
        </mat-form-field>
      </div>

      <!-- CTC -->
      <div class="section-header mt-8">
        <span class="section-accent"></span>
        <h3 class="section-title">CTC Calculations</h3>
        <div class="section-rule"></div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <div>
          <label class="field-label">CTC</label>
        <mat-form-field appearance="outline" class="w-full">
            <input matInput class="text-sm"
                   [value]="fmtMoney(d.ctc)" [readonly]="readOnlyMode" [disabled]="readOnlyMode" />
          </mat-form-field>
        </div>

        <div>
          <label class="field-label">CTC + Commission</label>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput class="text-sm"
                   [value]="fmtMoney(d.ctcPlusCommission)" [readonly]="readOnlyMode" [disabled]="readOnlyMode" />
          </mat-form-field>
        </div>

        <div>
          <label class="field-label">Net Profit (CTC - Commission)</label>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput class="text-sm"
                   [value]="fmtMoney(d.netAmount)" [readonly]="readOnlyMode" [disabled]="readOnlyMode" />
          </mat-form-field>
        </div>

        <div>
          <label class="field-label">Profit / Loss</label>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput class="text-sm"
                   [value]="profitOrLossLabel" [readonly]="readOnlyMode" [disabled]="readOnlyMode" />
          </mat-form-field>
        </div>

        <div>
          <label class="field-label">Profit / Loss Amount</label>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput class="text-sm"
                   [value]="profitOrLossAmount" [readonly]="readOnlyMode" [disabled]="readOnlyMode" />
          </mat-form-field>
        </div>

        <div>
          <label class="field-label">Is Price Overridden</label>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput class="text-sm"
                   [value]="isPriceOverriddenLabel" [readonly]="readOnlyMode" [disabled]="readOnlyMode" />
          </mat-form-field>
        </div>

        <div>
          <label class="field-label">Is Price Missing</label>
          <mat-form-field appearance="outline" class="w-full">
            <input matInput class="text-sm"
                   [value]="isMissingPriceLabel" [readonly]="readOnlyMode" [disabled]="readOnlyMode" />
          </mat-form-field>
        </div>
      </div>

      <div class="mt-2">
        <label class="field-label">CTC Calculations</label>
        <mat-form-field appearance="outline" class="w-full">
          <textarea matInput rows="8" class="text-sm leading-relaxed"
                    [readonly]="readOnlyMode" [disabled]="readOnlyMode">{{ d.ctcCalculationDetails || '-' }}</textarea>
        </mat-form-field>
      </div>
    </form>

    <div *ngIf="!isLoading && !detail" class="p-12 text-center text-gray-500">
      No details available.
    </div>
  </div>
</main>
